<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>FinCARE - User Profile & Settings</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDGeRJkrzIjtM51OFu8_58nAlxAof0QK98",
        authDomain: "fincare-project-4015e.firebaseapp.com",
        projectId: "fincare-project-4015e",
        storageBucket: "fincare-project-4015e.firebasestorage.app",
        messagingSenderId: "415209492661",
        appId: "1:415209492661:web:683ea15a1e177fb4c52efc",
        measurementId: "G-DNG4ZMXG1J"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            const userRef = doc(db, "users", user.uid);
            onSnapshot(userRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    // Update Name and Email
                    document.getElementById('profile-name').innerText = data.fullName || "User Name";
                    document.getElementById('profile-email').innerText = data.email || user.email;

                    // Push Notification Smooth Toggle State
                    const toggleBg = document.getElementById('notif-toggle');
                    const toggleDot = document.getElementById('notif-dot');
                    const isEnabled = data.preferences?.pushNotifications ?? true;
                    
                    if (isEnabled) {
                        toggleBg.style.backgroundColor = '#f2cc0d'; // Primary Color
                        toggleDot.style.transform = 'translateX(18px)';
                    } else {
                        toggleBg.style.backgroundColor = '#333'; // Muted Gray
                        toggleDot.style.transform = 'translateX(0px)';
                    }
                }
            });
        } else { window.location.href = "login.html"; }
    });

    // Clean Toggle Logic without Re-triggers
    window.toggleNotifications = async () => {
        const user = auth.currentUser;
        if (!user) return;
        const userRef = doc(db, "users", user.uid);
        
        // Use a simple one-time get or use current UI state to toggle
        const toggleBg = document.getElementById('notif-toggle');
        const currentState = toggleBg.style.backgroundColor === 'rgb(242, 204, 13)'; // Checking if it is currently Primary yellow
        
        try {
            await updateDoc(userRef, {
                "preferences.pushNotifications": !currentState
            });
        } catch(e) { console.error("Toggle failed", e); }
    };

    window.handleLogout = () => {
        signOut(auth).then(() => { window.location.href = "splash.html"; });
    };
</script>

<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f2cc0d",
                        "background-dark": "#000000",
                        "surface-dark": "#181711",
                        "border-dark": "#2a281d",
                        "muted-gold": "#bab59c"
                    },
                    fontFamily: { "display": ["Manrope", "sans-serif"] },
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        body { min-height: max(884px, 100dvh); background-color: #000; }
        .ios-scroll-hide::-webkit-scrollbar { display: none; }
        .active-icon { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        
        /* Smooth Toggle Animation */
        #notif-toggle { transition: background-color 0.3s ease; cursor: pointer; }
        #notif-dot { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-background-dark font-display text-white">
<div class="relative mx-auto h-[844px] w-[390px] overflow-hidden bg-background-dark shadow-2xl border-4 border-[#333] rounded-[3rem] flex flex-col">
    <div class="flex items-center justify-between px-8 pt-4 text-sm font-semibold text-white shrink-0">
        <span>9:41</span>
        <div class="flex items-center gap-1.5">
            <span class="material-symbols-outlined !text-[18px]">signal_cellular_alt</span>
            <span class="material-symbols-outlined !text-[18px]">wifi</span>
            <span class="material-symbols-outlined !text-[18px]">battery_full</span>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto ios-scroll-hide px-6 pt-6 pb-24">
        <div class="flex flex-col items-center mb-10">
            <div class="relative mb-4">
                <div class="w-24 h-24 rounded-full bg-surface-dark border-2 border-primary flex items-center justify-center overflow-hidden">
                    <img alt="User" class="w-full h-full object-cover" src="https://ui-avatars.com/api/?name=User&background=181711&color=f2cc0d"/>
                </div>
                <div class="absolute bottom-0 right-0 bg-primary text-black w-7 h-7 rounded-full flex items-center justify-center border-2 border-background-dark">
                    <span class="material-symbols-outlined !text-[16px] font-bold">edit</span>
                </div>
            </div>
            <h1 id="profile-name" class="text-2xl font-bold text-white tracking-tight">Loading...</h1>
            <p id="profile-email" class="text-muted-gold text-sm font-medium">email@example.com</p>
        </div>

        <div class="mb-8">
            <a class="w-full flex items-center justify-between p-4 bg-surface-dark border border-border-dark rounded-2xl active:scale-[0.98] transition-transform" href="userdetails.html">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary">person</span>
                    </div>
                    <div class="text-left">
                        <p class="font-bold text-white text-sm">Basic Profile</p>
                        <p class="text-xs text-muted-gold font-medium">Age, Employment, Personal Details</p>
                    </div>
                </div>
                <span class="material-symbols-outlined text-muted-gold">chevron_right</span>
            </a>
        </div>

        <div class="mb-8">
            <h3 class="text-muted-gold text-[10px] font-bold uppercase tracking-widest mb-3 px-1">Historical Insights</h3>
            <div class="bg-surface-dark border border-border-dark rounded-2xl overflow-hidden">
                <button class="w-full flex items-center justify-between p-4 border-b border-border-dark active:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4"><span class="material-symbols-outlined text-primary">history_edu</span><span class="font-medium text-sm">Transaction History</span></div>
                    <span class="material-symbols-outlined text-muted-gold text-xl">chevron_right</span>
                </button>
                <a class="w-full flex items-center justify-between p-4 border-b border-border-dark active:bg-white/5 transition-colors" href="reports.html">
                    <div class="flex items-center gap-4"><span class="material-symbols-outlined text-primary">analytics</span><span class="font-medium text-sm">Monthly Reports</span></div>
                    <span class="material-symbols-outlined text-muted-gold text-xl">chevron_right</span>
                </a>
                <button class="w-full flex items-center justify-between p-4 active:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4"><span class="material-symbols-outlined text-primary">account_balance_wallet</span><span class="font-medium text-sm">Tax Summary 2023-24</span></div>
                    <span class="material-symbols-outlined text-muted-gold text-xl">chevron_right</span>
                </button>
            </div>
        </div>

        <div class="mb-8">
            <h3 class="text-muted-gold text-[10px] font-bold uppercase tracking-widest mb-3 px-1">Settings & Security</h3>
            <div class="bg-surface-dark border border-border-dark rounded-2xl overflow-hidden">
                <button class="w-full flex items-center justify-between p-4 border-b border-border-dark active:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4"><span class="material-symbols-outlined text-primary">account_balance</span><span class="font-medium text-sm">Bank Connections</span></div>
                    <div class="flex items-center gap-2"><span class="text-[10px] text-green-500 font-bold">3 Active</span><span class="material-symbols-outlined text-muted-gold text-xl">chevron_right</span></div>
                </button>
                <button class="w-full flex items-center justify-between p-4 border-b border-border-dark active:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4"><span class="material-symbols-outlined text-primary">settings</span><span class="font-medium text-sm">Preferences</span></div>
                    <span class="material-symbols-outlined text-muted-gold text-xl">chevron_right</span>
                </button>
                <div onclick="toggleNotifications()" class="w-full flex items-center justify-between p-4 active:bg-white/5 transition-colors cursor-pointer">
                    <div class="flex items-center gap-4">
                        <span class="material-symbols-outlined text-primary">notifications_active</span>
                        <span class="font-medium text-sm">Push Notifications</span>
                    </div>
                    <div id="notif-toggle" class="w-10 h-5 rounded-full relative" style="background-color: #333;">
                        <div id="notif-dot" class="absolute left-0.5 top-0.5 w-4 h-4 bg-black rounded-full shadow-md"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <button onclick="handleLogout()" class="w-full flex items-center justify-center gap-3 p-4 bg-surface-dark border border-red-500/20 rounded-2xl active:scale-[0.98] transition-all">
                <span class="material-symbols-outlined text-red-500">logout</span>
                <span class="font-bold text-red-500">Log Out</span>
            </button>
            <p class="text-center text-[10px] text-muted-gold/50 mt-4 tracking-[0.2em]">VERSION 2.4.1 (BUILD 108)</p>
        </div>
    </div>

    <div class="absolute bottom-0 w-full bg-background-dark border-t border-border-dark px-6 pb-8 pt-3 flex justify-between items-center shrink-0">
        <a class="flex flex-col items-center gap-1 text-muted-gold hover:text-primary transition-colors" href="dashboard.html"><span class="material-symbols-outlined">dashboard</span><span class="text-[10px]">Dashboard</span></a>
        <a class="flex flex-col items-center gap-1 text-muted-gold hover:text-primary transition-colors" href="insights.html"><span class="material-symbols-outlined">analytics</span><span class="text-[10px]">Insights</span></a>
        <a class="flex flex-col items-center space-y-1 text-muted-gold" href="transactions.html"><span class="material-symbols-outlined">receipt_long</span><span class="text-[10px]">Transactions</span></a>
        <a class="flex flex-col items-center gap-1 text-primary" href="profile.html"><span class="material-symbols-outlined active-icon">person</span><span class="text-[10px]">Profile</span></a>
    </div>
    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1.5 bg-white/20 rounded-full pointer-events-none"></div>
</div>
</body></html>
