<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Life Goals Detail - FinCARE</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDGeRJkrzIjtM51OFu8_58nAlxAof0QK98",
            authDomain: "fincare-project-4015e.firebaseapp.com",
            projectId: "fincare-project-4015e",
            storageBucket: "fincare-project-4015e.firebasestorage.app",
            messagingSenderId: "415209492661",
            appId: "1:415209492661:web:683ea15a1e177fb4c52efc",
            measurementId: "G-DNG4ZMXG1J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserId = null;
        let userGoals = [];

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserId = user.uid;
                const userRef = doc(db, "users", user.uid);
                
                onSnapshot(userRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        
                        // NEW: Monthly Fix Deduction data from Step 5
                        const fixDeduction = parseFloat(data.monthlyFixDeduction) || 0;
                        document.getElementById('display-monthly-fix').innerText = '₹' + fixDeduction.toLocaleString('en-IN');

                        userGoals = data.lifeGoals || [];
                        const mainGoal = userGoals.length > 0 ? userGoals[0] : null;

                        if (mainGoal) {
                            const goalName = mainGoal.goalName || mainGoal.name || "My Goal";
                            document.getElementById('goal-title').innerText = goalName;
                            
                            const iconEl = document.getElementById('goal-icon');
                            if (goalName.toLowerCase().includes('car')) iconEl.innerText = 'directions_car';
                            else if (goalName.toLowerCase().includes('house')) iconEl.innerText = 'home';
                            else if (goalName.toLowerCase().includes('retirement')) iconEl.innerText = 'savings';
                            else iconEl.innerText = 'track_changes';

                            const target = parseFloat(mainGoal.targetAmount) || 0;
                            const saved = parseFloat(mainGoal.currentSavings) || 0;
                            const remaining = target - saved;

                            let timelineMonths = 0;
                            const targetYear = parseInt(mainGoal.targetYear) || parseInt(mainGoal.year);
                            const currentYear = 2026;
                            
                            if (targetYear) {
                                timelineMonths = (targetYear - currentYear) * 12;
                                if (timelineMonths < 0) timelineMonths = 0;
                            }

                            document.getElementById('val-saved').innerText = '₹' + saved.toLocaleString('en-IN');
                            document.getElementById('val-target').innerText = '₹' + target.toLocaleString('en-IN');
                            document.getElementById('val-remaining-box').innerText = '₹' + (remaining > 0 ? remaining : 0).toLocaleString('en-IN');
                            document.getElementById('val-timeline').innerText = timelineMonths;

                            const progress = target > 0 ? Math.min((saved / target) * 100, 100) : 0;
                            document.getElementById('ui-progress-bar').style.width = progress + '%';
                            document.getElementById('ui-perc-text').innerText = Math.round(progress) + '% Completed';
                            document.getElementById('ui-left-text').innerText = '₹' + (remaining > 0 ? remaining : 0).toLocaleString('en-IN') + ' to go';
                        }
                    }
                });
            } else { window.location.href = "login.html"; }
        });

        window.addFunds = async () => {
            const amount = prompt("Enter amount to add (₹):");
            if (amount && !isNaN(amount) && currentUserId && userGoals.length > 0) {
                userGoals[0].currentSavings = (parseFloat(userGoals[0].currentSavings) || 0) + parseFloat(amount);
                await updateDoc(doc(db, "users", currentUserId), { lifeGoals: userGoals });
            }
        };
    </script>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { primary: "#EAB308", "background-dark": "#000000", "accent-green": "#4ADE80" },
                    fontFamily: { display: ["Inter", "sans-serif"] },
                },
            },
        };
    </script>
    <style type="text/tailwindcss">
        :root { --glass-bg: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1); }
        body { font-family: 'Inter', sans-serif; background-color: #000000; color: white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); }
    </style>
</head>
<body class="bg-black antialiased flex items-center justify-center min-h-screen">
<div class="max-w-[430px] w-full h-[932px] mx-auto overflow-hidden relative shadow-2xl bg-black border-x border-gray-900">
    <div class="h-11 relative z-20 flex justify-between items-end px-8 pb-1 opacity-60">
        <span class="text-xs font-semibold">9:41</span>
        <div class="flex space-x-1.5 items-center">
            <span class="material-symbols-outlined text-[14px]">signal_cellular_alt</span>
            <span class="material-symbols-outlined text-[14px]">wifi</span>
            <span class="material-symbols-outlined text-[14px]">battery_full</span>
        </div>
    </div>

    <header class="relative z-20 px-6 py-4 flex items-center justify-between">
        <a class="w-10 h-10 flex items-center justify-center rounded-full glass-card" href="dashboard.html">
            <span class="material-symbols-outlined">chevron_left</span>
        </a>
        <h1 class="text-lg font-bold tracking-tight">Life Goals</h1>
        <button class="w-10 h-10 flex items-center justify-center rounded-full glass-card">
            <span class="material-symbols-outlined">settings</span>
        </button>
    </header>

    <main class="relative z-10 px-6 pt-6 h-[calc(100%-180px)] overflow-y-auto no-scrollbar">
        <div class="mb-8 text-center">
            <div class="w-20 h-20 bg-primary/10 rounded-3xl flex items-center justify-center mx-auto mb-4 border border-primary/20">
                <span id="goal-icon" class="material-symbols-outlined text-primary text-4xl font-light">track_changes</span>
            </div>
            <h2 id="goal-title" class="text-3xl font-bold">...</h2>
            <p class="text-accent-green font-medium mt-1">On Track</p>
        </div>

        <div class="glass-card p-5 rounded-[28px] mb-6 border-l-4 border-l-primary">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-primary/10 rounded-2xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-2xl font-light">event_repeat</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-sm text-white">Monthly Fix</h3>
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest">Auto Deduction</p>
                    </div>
                </div>
                <div class="text-right">
                    <p id="display-monthly-fix" class="text-xl font-black text-primary">₹0</p>
                    <p class="text-[9px] text-slate-500 font-bold">PER MONTH</p>
                </div>
            </div>
        </div>

        <div class="glass-card p-6 rounded-[32px] mb-6">
            <div class="flex justify-between items-end mb-4">
                <div>
                    <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mb-1">Total Saved</p>
                    <h3 id="val-saved" class="text-3xl font-bold">₹0</h3>
                </div>
                <div class="text-right">
                    <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mb-1">Target</p>
                    <p id="val-target" class="text-lg font-semibold text-slate-200">₹0</p>
                </div>
            </div>
            <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden mb-2">
                <div id="ui-progress-bar" class="h-full bg-primary rounded-full transition-all duration-1000" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-[10px] font-bold text-slate-500 uppercase tracking-tighter">
                <span id="ui-perc-text">0% Completed</span>
                <span id="ui-left-text">₹0 to go</span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-32">
            <div class="glass-card p-5 rounded-3xl">
                <span class="material-symbols-outlined text-blue-400 mb-2">calendar_today</span>
                <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mb-1">Time Left</p>
                <p class="text-xl font-bold"><span id="val-timeline">0</span> <span class="text-xs font-normal text-slate-400">Months</span></p>
            </div>
            <div class="glass-card p-5 rounded-3xl">
                <span class="material-symbols-outlined text-purple-400 mb-2">payments</span>
                <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mb-1">Remaining</p>
                <p id="val-remaining-box" class="text-xl font-bold">₹0</p>
            </div>
        </div>
    </main>

    <nav class="absolute bottom-0 left-0 right-0 z-30 px-6 pt-4 pb-12 glass-card border-t border-white/5 rounded-t-[32px]">
        <button onclick="addFunds()" class="w-full bg-primary text-black font-bold py-4 rounded-2xl flex items-center justify-center space-x-2 active:scale-95 transition-transform">
            <span class="material-symbols-outlined font-bold">add</span>
            <span>Add Extra Funds</span>
        </button>
    </nav>
    <div class="absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1.5 bg-white/20 rounded-full z-40"></div>
</div>
</body>
</html>